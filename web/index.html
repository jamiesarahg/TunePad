<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1">
  <meta name="format-detection" content="telephone=no">
  <title>TunePad</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/font-awesome.min.css">
  <!--
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700italic" rel="stylesheet">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
  -->
</head>

<body>
  <div class="content">
    <!-- video id="video-stream"></video -->
    <canvas id="video-canvas" width="1366" height="1024"></canvas>
    <!--
    <button id="camera-button"><span class="fa fa-video-camera"></span></button>
    <button id="compile-button"><span class="fa fa-video-camera"></span></button>
    -->
  </div>

  <script type="application/dart" src="dart/main.dart"></script>
  <script src="packages/browser/dart.js"></script>
  <!--
  <script src="js/adapter-0.2.9.js"></script>
  <script src="js/video.js"></script>
  -->

  <script>
    //var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    /*
    var audioCtx = new window.AudioContext();
    var analyser = audioCtx.createAnalyser();
    analyser.fftSize = 512;
    var bufferLength = analyser.frequencyBinCount;
    var dataArray = new Uint8Array(bufferLength);
    //analyser.getByteTimeDomainData(dataArray);

    var canvas = document.getElementById('video-canvas');
    var canvasCtx = canvas.getContext('2d');

    var WIDTH = 600;
    var HEIGHT = 400;
    draw();

    var request = new XMLHttpRequest();
    request.open('GET', 'sounds/eightbit/1_eight-bit Atari Pad-001.wav', true);
    request.responseType = 'arraybuffer';

    request.onload = function() {
      audioCtx.decodeAudioData(request.response, function(buffer) {
        console.log(buffer);
        $('#play').click(function() {
          console.log("play");
          var source = audioCtx.createBufferSource();
          source.buffer = buffer;
          source.connect(analyser);
          analyser.connect(audioCtx.destination);          
          source.start(0);
        }).removeAttr('disabled');
      }, function(err) { console.log(err); });
    };
    request.send();

    // draw an oscilloscope of the current audio source

    function draw() {

      drawVisual = requestAnimationFrame(draw);

      analyser.getByteTimeDomainData(dataArray);

      canvasCtx.fillStyle = 'rgb(200, 200, 200)';
      canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);

      canvasCtx.lineWidth = 2;
      canvasCtx.strokeStyle = 'rgb(0, 0, 0)';

      canvasCtx.beginPath();

      var sliceWidth = WIDTH * 1.0 / bufferLength;
      var x = 0;

      for(var i = 0; i < bufferLength; i++) {
   
        var v = dataArray[i] / 128.0;
        var y = v * HEIGHT/2;

        if(i === 0) {
          canvasCtx.moveTo(x, y);
        } else {
          canvasCtx.lineTo(x, y);
        }

        x += sliceWidth;
      }

      canvasCtx.lineTo(WIDTH, HEIGHT/2);
      canvasCtx.stroke();
    };
  */
  </script>
</body>
</html>
